<html>
  <head>
    <style>
      canvas{
        border:1px solid gray;
        box-shadow:5px 5px 5px gray;
        border-radius:5px;
        display:inline-block;
        margin:20px;
      }
    </style>

  </head>
  <body onload="init()">
    <canvas id="game" width="700px" height="512px"></canvas>
    <script src="gamelib.js"></script>
    <script>
        var sources = [{id:"ring",src:"ring2.png"},
                        {id:"bk",src:"day.png"},
                        {id:"bird",src:"bird.png"},
                        {id:"pipeTop",src:"pipe_top.png"},
                        {id:"pipeBot",src:"pipe_bot.png"},
                        {id:"bar",src:"bar.png"},
                        {id:"title",src:"logo.png"},
                        {id:"end",src:"flappybird_end.png"},
                        {id:"coin",src:"Coins.png"}
                      ];
        var crossed = false;
        function gameloop(){
            if(!game.over){
              game.scrollBackground(-2,0);

              pipe.top.draw();
              pipe.top.x -= 2;
              pipe.bot.draw();
              pipe.bot.x -= 2;
              if(pipe.top.x < -100){
                pipe.top.x = game.width + 100;
                pipe.bot.x = game.width + 100;
                pipe.top.y = rnd(-250,0);
                pipe.bot.y = pipe.top.y + 400;
                crossed = false;
              }
              bar.draw();
              game.drawText("Score:" + game.score,50,480);
              hero.draw();
              hero.y += 1;
              if(key.pressed == key.space){
                hero.y -= 2;
              }

              if(hero.collidedWith(bar) || hero.collidedWith(pipe.top) || hero.collidedWith(pipe.bot)){
                console.log("Dead");
                gameover.draw();
                game.over = true;
              }
              if(hero.left > pipe.top.right && !crossed){
                game.score += 10;
                crossed = true;
              }

            }else{
              game.drawText("Play Again? (Y/N)",220,480,"24pt Comic Sans MS shadow-black","white");
              if(key.pressed == key.Y){
                gameloop();
              }
            }
            setTimeout(function(){gameloop()},10);
        }

        function startup(){
          game.scrollBackground(-2,0);
          title.draw();
          game.drawText("Press [Space] to Start",200,280,"24pt Comic Sans MS shadow-black","white");
          if(key.pressed == key.space){
            gameloop();
          }else{
            setTimeout(function(){startup()},10);
          }
        }
        function init(){
            game = new Game("game");
            game.preload(sources,function(){
                bk = new Sprite(game.images.bk,game);
                game.setBackground(bk);
                bar = new Animation(game.images.bar,game,700,110,3,350,470);
                hero = new Animation(game.images.bird,game,92,64,3,game.width / 3, game.height / 2);
                hero.scale = 0.75;
                pipe = {top: new Sprite(game.images.pipeTop,game,game.width+100), bot: new Sprite(game.images.pipeBot,game,game.width+100)};
                pipe.top.y = rnd(-250,0);
                pipe.bot.y = pipe.top.y + 400;
                title =  new Sprite(game.images.title,game,250,150);
                gameover =  new Sprite(game.images.end,game,80,150);
                gameloop();
            });
        }

    </script>
  </body>
</html>
